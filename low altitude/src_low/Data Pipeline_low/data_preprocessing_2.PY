import os

# ë°ì´í„°ì…‹ ë£¨íŠ¸ ê²½ë¡œ (ì´ë¯¸ì§€ì™€ ë¼ë²¨ì´ ì„ì—¬ ìˆëŠ” ê²½ìš° ëŒ€ì‘)
root_path = r"D:\Parking Detection.v1i.yolov11\datasat"

def final_sync_cleanup():
    """
    [ì¸ìˆ˜ì¸ê³„ ë…¸íŠ¸]
    ëª©ì : ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì§ì´ ì—†ëŠ” ë¼ë²¨(.txt) íŒŒì¼ì„ ì „ìˆ˜ ì¡°ì‚¬í•˜ì—¬ ì‚­ì œí•©ë‹ˆë‹¤.
    í•„ìš”ì„±: ì „ì²˜ë¦¬ ê³¼ì •ì—ì„œ ì´ë¯¸ì§€ë§Œ ì‚­ì œëœ ê²½ìš°, í•™ìŠµ ì‹œ ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    """
    all_images = set()
    all_labels = []
    image_extensions = ('.jpg', '.jpeg', '.png')

    # 1. ì „ì²´ ê²½ë¡œë¥¼ ìŠ¤ìº”í•˜ì—¬ ì´ë¯¸ì§€ íŒŒì¼ëª…(í™•ì¥ì ì œì™¸)ê³¼ ë¼ë²¨ íŒŒì¼ ì „ì²´ ê²½ë¡œ ìˆ˜ì§‘
    for root, _, files in os.walk(root_path):
        for f in files:
            name, ext = os.path.splitext(f)
            if ext.lower() in image_extensions:
                all_images.add(name) # ì¤‘ë³µ ì²´í¬ë¥¼ ìœ„í•´ set ì‚¬ìš©
            elif ext.lower() == '.txt':
                # ì‹œìŠ¤í…œ íŒŒì¼ ì œì™¸ ë¡œì§
                if name not in ['classes', 'requirements', 'notes', 'README']:
                    all_labels.append(os.path.join(root, f))

    # 2. ìˆ˜ì§‘ëœ ë¼ë²¨ íŒŒì¼ë“¤ì„ ëŒë©° ëŒ€ì‘í•˜ëŠ” ì´ë¯¸ì§€ê°€ ìˆëŠ”ì§€ ëŒ€ì¡°
    deleted_count = 0
    for label_path in all_labels:
        label_name = os.path.splitext(os.path.basename(label_path))[0]
        
        # ì´ë¯¸ì§€ ì…‹(set)ì— íŒŒì¼ëª…ì´ ì—†ë‹¤ë©´ ì‚­ì œ ëŒ€ìƒ
        if label_name not in all_images:
            try:
                os.remove(label_path)
                deleted_count += 1
            except Exception as e:
                print(f"âŒ ì‚­ì œ ì‹¤íŒ¨: {label_path} ({e})")

    print(f"ğŸ§¹ ê²°ê³¼: ì§ì´ ì—†ëŠ” ë¼ë²¨ {deleted_count}ê°œ ì‚­ì œ ì™„ë£Œ. ì´ë¯¸ì§€-ë¼ë²¨ ë™ê¸°í™” ì„±ê³µ.")